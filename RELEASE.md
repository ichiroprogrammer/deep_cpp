# リリースについて

## version.txt
このファイルはこのドキュメントのバージョンを以下の形式で保持する。
    MM.NN

    MM:メジャー番号
    NN:マイナー番号

ドキュメントが対象とするC++のバージョンをCppVerで表すと、
    MM = CppVer + N(0=< N && N <3)

で表す。

したがって、C++20を対象とするこのドキュメントのメジャー番号は20～22となる。

## リリース手順<a id="gen_doc"></a>
0. ドキュメントやコードの修正をする。
0. ドキュメントを[ビルド](#build)をし、レビューを済ませる。
0. version.txtを修正する。
0. git addするし、修正ファイルをステージング状態にする。
0. 下記を実行ことでコミットする。

``` sh
    $ cd <TOP-DIR>
    $ ./tools/git_ci_release.py
    $ git push  # プッシュが必要に応じて
```

0. 「[生成物の保存](#store_doc)」に従い、生成物を保存する。



## ドキュメントのビルド<a id="build"></a>
このリポジトリのドキュメントは、以下のようにすることで生成される。

``` sh
    $ cd <TOP-DIR>
    $ make
    $ ls o/*.md       # 生成物(マークダウンドキュメント)一覧
```


makeのターゲットを一覧を表示するためには、

``` sh
    $ make help
```

このドキュメントで使用されるpngファイルは、下記のような形式でドキュメント内に直接埋め込まれる。

    <p><img src="data:image/png;base64,...

この形式は便利であるものの、
この形式を含むファイルをchatgptに張り付けるとセッションがストールすることがあるため、
ドキュメントをchatgptにレビューさせる場合、この形式の場所に、
元のplant umlソースコードを埋め込むことが必要になる。以下のようにすることで、
こういったドキュメントを生成するすることができる。

``` sh
    $ cd <TOP-DIR>
    $ make mds_pu     # o/puの下にドキュメントが生成される。
```

ドキュメント内で使用されるコードはドキュメント生成前に単体テストやformattingを行うべきである。
下記のコマンドによりそういったことや、makeによるドキュメント生成を一度に行える。

``` sh
    $ cd <TOP-DIR>
    $ ./build.sh

    $ build.sh -h   # オプションの説明
```
    
    
## 生成物の保存<a id="store_doc"></a>
このリポジトリでは生成物を保持しないため、生成物は下記のリポジトリで管理する。

    git@github.com:ichiroprogrammer/cpp_docs.git 


下記のコマンド行うことにより、[生成したドキュメント](#gen_doc)ををcpp_docs.gitで管理できる。

``` sh
    $ cd cpp_docs.git
    $ ./release.py --repos <REPOS>
```
